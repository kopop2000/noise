name: Build VST2 Plugin

on: [workflow_dispatch]

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Setup MSVC
      uses: ilammy/msvc-dev-cmd@v1
      
    - name: Clone and Build
      run: |
        git clone https://github.com/vaisest/noise-suppression-for-voice.git
        cd noise-suppression-for-voice
        
        mkdir build
        cd build
        
        # Конфигурируем проект
        cmake .. -G "Visual Studio 17 2022" -A x64
        
        # Собираем ВСЕ цели, а не конкретную
        cmake --build . --config Release --parallel 4
        
    - name: Find Built Files
      run: |
        # Ищем все собранные DLL файлы
        echo "=== Searching for DLL files ==="
        dir noise-suppression-for-voice\build\Release\*.dll /s
        dir noise-suppression-for-voice\build\bin\*.dll /s 2>nul || echo "No bin directory"
        
    - name: Upload Results
      uses: actions/upload-artifact@v4
      with:
        name: noise-suppression-build
        path: |
          noise-suppression-for-voice/build/Release/
          noise-suppression-for-voice/build/bin/
