name: Build VST2 Plugin

on: [workflow_dispatch]

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Setup MSVC
      uses: ilammy/msvc-dev-cmd@v1
      
    - name: Clone and List Projects
      run: |
        git clone https://github.com/vaisest/noise-suppression-for-voice.git
        cd noise-suppression-for-voice
        
        mkdir build
        cd build
        
        # Конфигурируем проект
        cmake .. -G "Visual Studio 17 2022" -A x64
        
        # Смотрим какие проекты есть
        echo "=== AVAILABLE PROJECTS ==="
        dir *.vcxproj
        
    - name: Build ALL Projects
      run: |
        cd noise-suppression-for-voice/build
        
        # Собираем ВСЕ проекты
        cmake --build . --config Release --parallel 4
        
    - name: Find All Built Files
      run: |
        echo "=== ALL BUILT FILES ==="
        dir noise-suppression-for-voice\build\ /s *.dll
        dir noise-suppression-for-voice\build\ /s *.exe
        dir noise-suppression-for-voice\build\ /s *.vst3
        
    - name: Upload Everything
      uses: actions/upload-artifact@v4
      with:
        name: all-built-files
        path: noise-suppression-for-voice/build/
